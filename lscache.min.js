!function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.lscache=b()}(this,function(){function j(){var a="__lscachetest__",b=a;if(void 0!==f)return f;try{q(a,b),r(a),f=!0}catch(c){f=k(c)?!0:!1}return f}function k(a){return a&&"QUOTA_EXCEEDED_ERR"===a.name||"NS_ERROR_DOM_QUOTA_REACHED"===a.name||"QuotaExceededError"===a.name?!0:!1}function l(){return void 0===g&&(g=null!=window.JSON),g}function m(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function n(a){return a+b}function o(){return Math.floor((new Date).getTime()/d)}function p(b){return localStorage.getItem(a+h+b)}function q(b,c){localStorage.removeItem(a+h+b),localStorage.setItem(a+h+b,c)}function r(b){localStorage.removeItem(a+h+b)}function s(c){for(var d=new RegExp("^"+a+m(h)+"(.*)"),e=localStorage.length-1;e>=0;--e){var f=localStorage.key(e);f=f&&f.match(d),f=f&&f[1],f&&f.indexOf(b)<0&&c(f,n(f))}}function t(a){var b=n(a);r(a),r(b)}function u(a){var b=n(a),d=p(b);if(d){var e=parseInt(d,c);if(o()>=e)return r(a),r(b),!0}}function v(a,b){i&&"console"in window&&"function"==typeof window.console.warn&&(window.console.warn("lscache - "+a),b&&window.console.warn("lscache - The error was: "+b.message))}var f,g,a="lscache-",b="-cacheexpiration",c=10,d=6e4,e=Math.floor(864e13/d),h="",i=!1,w={set:function(a,b,d){if(j()){if("string"!=typeof b){if(!l())return;try{b=JSON.stringify(b)}catch(f){return}}try{q(a,b)}catch(f){if(!k(f))return v("Could not add item with key '"+a+"'",f),void 0;var h,g=[];s(function(a,b){var d=p(b);d=d?parseInt(d,c):e,g.push({key:a,size:(p(a)||"").length,expiration:d})}),g.sort(function(a,b){return b.expiration-a.expiration});for(var i=(b||"").length;g.length&&i>0;)h=g.pop(),v("Cache is full, removing item with key '"+a+"'"),t(h.key),i-=h.size;try{q(a,b)}catch(f){return v("Could not add item with key '"+a+"', perhaps it's too big?",f),void 0}}d?q(n(a),(o()+d).toString(c)):r(n(a))}},get:function(a){if(!j())return null;if(u(a))return null;var b=p(a);if(!b||!l())return b;try{return JSON.parse(b)}catch(c){return b}},remove:function(a){j()&&t(a)},supported:function(){return j()},flush:function(){j()&&s(function(a){t(a)})},flushExpired:function(){j()&&s(function(a){u(a)})},setBucket:function(a){h=a},resetBucket:function(){h=""},enableWarnings:function(a){i=a}};return w});
